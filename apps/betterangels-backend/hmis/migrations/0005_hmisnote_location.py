# Generated by Django 5.2.8 on 2025-12-01 23:21

import django.db.models.deletion
import pgtrigger.compiler
import pgtrigger.migrations
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("common", "0018_fix_file_extensions"),
        ("hmis", "0004_hmisnote_services"),
    ]

    operations = [
        pgtrigger.migrations.RemoveTrigger(
            model_name="hmisnote",
            name="hmisnote_add_insert",
        ),
        pgtrigger.migrations.RemoveTrigger(
            model_name="hmisnote",
            name="hmisnote_update_update",
        ),
        pgtrigger.migrations.RemoveTrigger(
            model_name="hmisnote",
            name="hmisnote_remove_delete",
        ),
        migrations.AddField(
            model_name="hmisnote",
            name="location",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="hmis_notes",
                to="common.location",
            ),
        ),
        migrations.AddField(
            model_name="hmisnoteevent",
            name="location",
            field=models.ForeignKey(
                blank=True,
                db_constraint=False,
                null=True,
                on_delete=django.db.models.deletion.DO_NOTHING,
                related_name="+",
                related_query_name="+",
                to="common.location",
            ),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name="hmisnote",
            trigger=pgtrigger.compiler.Trigger(
                name="hmisnote_add_insert",
                sql=pgtrigger.compiler.UpsertTriggerSql(
                    func='INSERT INTO "hmis_hmisnoteevent" ("added_date", "created_at", "created_by_id", "date", "hmis_client_profile_id", "hmis_id", "id", "last_updated", "location_id", "note", "pgh_context_id", "pgh_created_at", "pgh_label", "pgh_obj_id", "ref_client_program", "title", "updated_at") VALUES (NEW."added_date", NEW."created_at", NEW."created_by_id", NEW."date", NEW."hmis_client_profile_id", NEW."hmis_id", NEW."id", NEW."last_updated", NEW."location_id", NEW."note", _pgh_attach_context(), NOW(), \'hmisnote.add\', NEW."id", NEW."ref_client_program", NEW."title", NEW."updated_at"); RETURN NULL;',
                    hash="81190493aeb5ad353ff574b3ceb1acd5d424b7f4",
                    operation="INSERT",
                    pgid="pgtrigger_hmisnote_add_insert_1bbc9",
                    table="hmis_hmisnote",
                    when="AFTER",
                ),
            ),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name="hmisnote",
            trigger=pgtrigger.compiler.Trigger(
                name="hmisnote_update_update",
                sql=pgtrigger.compiler.UpsertTriggerSql(
                    condition="WHEN (OLD.* IS DISTINCT FROM NEW.*)",
                    func='INSERT INTO "hmis_hmisnoteevent" ("added_date", "created_at", "created_by_id", "date", "hmis_client_profile_id", "hmis_id", "id", "last_updated", "location_id", "note", "pgh_context_id", "pgh_created_at", "pgh_label", "pgh_obj_id", "ref_client_program", "title", "updated_at") VALUES (NEW."added_date", NEW."created_at", NEW."created_by_id", NEW."date", NEW."hmis_client_profile_id", NEW."hmis_id", NEW."id", NEW."last_updated", NEW."location_id", NEW."note", _pgh_attach_context(), NOW(), \'hmisnote.update\', NEW."id", NEW."ref_client_program", NEW."title", NEW."updated_at"); RETURN NULL;',
                    hash="ac7f1eddd96962f6bcaef792a279e2b08b060eac",
                    operation="UPDATE",
                    pgid="pgtrigger_hmisnote_update_update_2ee8d",
                    table="hmis_hmisnote",
                    when="AFTER",
                ),
            ),
        ),
        pgtrigger.migrations.AddTrigger(
            model_name="hmisnote",
            trigger=pgtrigger.compiler.Trigger(
                name="hmisnote_remove_delete",
                sql=pgtrigger.compiler.UpsertTriggerSql(
                    func='INSERT INTO "hmis_hmisnoteevent" ("added_date", "created_at", "created_by_id", "date", "hmis_client_profile_id", "hmis_id", "id", "last_updated", "location_id", "note", "pgh_context_id", "pgh_created_at", "pgh_label", "pgh_obj_id", "ref_client_program", "title", "updated_at") VALUES (OLD."added_date", OLD."created_at", OLD."created_by_id", OLD."date", OLD."hmis_client_profile_id", OLD."hmis_id", OLD."id", OLD."last_updated", OLD."location_id", OLD."note", _pgh_attach_context(), NOW(), \'hmisnote.remove\', OLD."id", OLD."ref_client_program", OLD."title", OLD."updated_at"); RETURN NULL;',
                    hash="3dbdbd3635aeea96308005dab1835d0915ec8c32",
                    operation="DELETE",
                    pgid="pgtrigger_hmisnote_remove_delete_07afe",
                    table="hmis_hmisnote",
                    when="AFTER",
                ),
            ),
        ),
    ]
