# Generated by Django 5.2.4 on 2025-07-30 20:40

from django.db import migrations

from django.db import models
from django.utils.translation import gettext_lazy as _


class TaskPermissions(models.TextChoices):
    VIEW = "notes.view_task", _("Can view task")
    CHANGE = "notes.change_task", _("Can change task")
    DELETE = "notes.delete_task", _("Can delete task")
    ADD = "notes.add_task", _("Can add task")


def delete_task_permissions(apps, schema_editor):
    Task = apps.get_model("notes", "Task")
    Permission = apps.get_model("auth", "Permission")
    ContentType = apps.get_model("contenttypes", "ContentType")
    TaskContentType = ContentType.objects.get_for_model(Task)
    db_alias = schema_editor.connection.alias

    PERM_MAP = {perm.split(".")[1]: perm.label for perm in TaskPermissions}
    for codename, _ in PERM_MAP.items():
        Permission.objects.using(db_alias).delete(
            codename=codename,
            content_type=TaskContentType,
        )


class Migration(migrations.Migration):

    dependencies = [
        ("notes", "0017_remove_note_note_add_insert_and_more"),
    ]

    operations = [migrations.RunPython(delete_task_permissions)]
